{"version":3,"file":"bundle.min.js","sources":["../src/index.js"],"sourcesContent":["const http = process.env.NODE_ENV==='production' ? require('https') : require('http')\n\nconst API_ENDPOINT = process.env.NODE_ENV==='production' ? `https://api.squarelink.com` : `http://localhost:3007`\n\nconst APP_URL = process.env.NODE_ENV==='production' ? `https://app.squarelink.com` : `http://localhost:8082`\n\nconst POPUP_PARAMS = `scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=450,height=700,left=-500,top=150`\n\nconst _serialize = function(obj) {\n  var str = []\n  for (var p in obj)\n    if (obj.hasOwnProperty(p)) {\n      str.push(encodeURIComponent(p) + \"=\" + encodeURIComponent(obj[p]))\n    }\n  return str.join('&')\n}\n\nconst _popup = function(url) {\n  return new Promise((resolve, reject) => {\n    const popup = window.open(url, 'Squarelink', POPUP_PARAMS)\n    popup.focus()\n    let self = this\n    window.addEventListener('message', function(e) {\n      if (e.data.origin === 'squarelink') {\n        popup.close()\n        window.removeEventListener('message', function() {})\n        resolve({ ...e.data, origin: undefined })\n      }\n    }, false)\n  })\n}\n\nconst _request = function(method='GET', url, params) {\n  return new Promise((resolve, reject) => {\n    if (method === 'GET') {\n      http.get(`${url}?${_serialize(params)}`, (res) => {\n        let data = ''\n        res.on('data', (chunk) => {\n          data += chunk\n          console.log(data)\n        })\n        res.on('end', () => {\n          resolve(JSON.parse(data))\n        })\n      }).on('error', (err) => {\n        reject(err)\n      })\n    }\n  })\n}\n\nexport default class Squarelink {\n  constructor(client_id, network = 'mainnet', options = {}) {\n    this.client_id = client_id\n    this.network = network || 'mainnet'\n    this.options = options\n  }\n\n  getCoinbase() {\n    return new Promise(async (resolve, reject) => {\n      if (this.accounts) {\n        resolve(this.accounts[0])\n      } else {\n        this.getAccounts().then(accounts => {\n          resolve(accounts[0])\n        }).catch(err => reject(err))\n      }\n    })\n  }\n\n  getAccounts() {\n    return new Promise(async (resolve, reject) => {\n      if (this.accounts) {\n        resolve(this.accounts)\n      } else {\n        let url = `${APP_URL}/authorize?client_id=${this.client_id}&scope=[wallets:read]&response_type=token&widget=true`\n        let access_token = (await _popup(url)).result\n        _request('GET', `${API_ENDPOINT}/wallets`, { access_token }).then((data) => {\n          let accounts = data.wallets.map(w => w.address)\n          this.accounts = accounts\n          resolve(accounts)\n        })\n      }\n    })\n  }\n\n  async signMsg({ message, params, method }) {\n    let url = `${APP_URL}/msg?client_id=560346b97085cb98cdc9&method=${method || 'signMessage'}`\n    if (method === 'signTypedMessage') {\n      url = `${url}&params=${_serialize(params)}`\n    } else {\n      url = `${url}&msg=${message}`\n    }\n    return (await _popup(url)).result\n  }\n\n  async signTx({ value, to, data }) {\n    let url = `${APP_URL}/tx?widget=true&method=eth_signTransaction&client_id=${this.client_id}&to=${to}&value=${value || '0'}`\n    if (data) url = `${url}&data=${data}`\n    return (await _popup(url)).result\n  }\n}\n"],"names":["http","process","env","NODE_ENV","require","API_ENDPOINT","APP_URL","_serialize","obj","str","p","hasOwnProperty","push","encodeURIComponent","join","_popup","url","Promise","resolve","reject","popup","window","open","focus","addEventListener","e","data","origin","close","removeEventListener","undefined","_request","method","params","get","res","on","chunk","log","JSON","parse","err","client_id","network","options","async","this","accounts","getAccounts","then","catch","access_token","result","wallets","map","w","address","message","value","to"],"mappings":"yNAAA,MAAMA,EAA8B,eAAvBC,QAAQC,IAAIC,SAA0BC,QAAQ,SAAWA,QAAQ,QAExEC,EAAsC,eAAvBJ,QAAQC,IAAIC,SAA2B,6BAA+B,wBAErFG,EAAiC,eAAvBL,QAAQC,IAAIC,SAA2B,6BAA+B,wBAIhFI,EAAa,SAASC,OACtBC,EAAM,OACL,IAAIC,KAAKF,EACRA,EAAIG,eAAeD,MACjBE,KAAKC,mBAAmBH,GAAK,IAAMG,mBAAmBL,EAAIE,YAE3DD,EAAIK,KAAK,MAGZC,EAAS,SAASC,UACf,IAAIC,QAAQ,CAACC,EAASC,WACrBC,EAAQC,OAAOC,KAAKN,EAAK,aAbb,mHAcZO,eAECC,iBAAiB,UAAW,SAASC,GACpB,eAAlBA,EAAEC,KAAKC,WACHC,eACCC,oBAAoB,UAAW,qBACzBJ,EAAEC,MAAMC,YAAQG,QAE9B,MAIDC,EAAW,SAASC,EAAO,MAAOhB,EAAKiB,UACpC,IAAIhB,QAAQ,CAACC,EAASC,KACZ,QAAXa,KACGE,OAAOlB,KAAOT,EAAW0B,KAAYE,QACpCT,EAAO,KACPU,GAAG,OAASC,OACNA,UACAC,IAAIZ,OAEVU,GAAG,MAAO,OACJG,KAAKC,MAAMd,QAEpBU,GAAG,QAAUK,MACPA,eAMA,kBACDC,EAAWC,EAAU,UAAWC,EAAU,SAC/CF,UAAYA,OACZC,QAAUA,GAAW,eACrBC,QAAUA,uBAIR,IAAI3B,QAAQ4B,MAAO3B,EAASC,KAC7B2B,KAAKC,WACCD,KAAKC,SAAS,SAEjBC,cAAcC,KAAKF,MACdA,EAAS,MAChBG,MAAMT,GAAOtB,EAAOsB,2BAMpB,IAAIxB,QAAQ4B,MAAO3B,EAASC,QAC7B2B,KAAKC,WACCD,KAAKC,cACR,KACD/B,KAASV,yBAA+BwC,KAAKJ,iEAC7CS,SAAsBpC,EAAOC,IAAMoC,SAC9B,SAAU/C,YAAwB,CAAE8C,aAAAA,IAAgBF,KAAMvB,QAC7DqB,EAAWrB,EAAK2B,QAAQC,IAAIC,GAAKA,EAAEC,cAClCT,SAAWA,IACRA,uBAMFU,QAAEA,EAAFxB,OAAWA,EAAXD,OAAmBA,QAC3BhB,KAASV,+CAAqD0B,GAAU,yBAC7D,qBAAXA,KACOhB,YAAcT,EAAW0B,QAEzBjB,SAAWyC,WAER1C,EAAOC,IAAMoC,qBAGhBM,MAAEA,EAAFC,GAASA,EAATjC,KAAaA,QACpBV,KAASV,yDAA+DwC,KAAKJ,gBAAgBiB,WAAYD,GAAS,aAClHhC,IAAMV,KAASA,UAAYU,YACjBX,EAAOC,IAAMoC"}