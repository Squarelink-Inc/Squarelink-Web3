var Squarelink=function(e,n,t,r,o,i,a,u){"use strict";e=e&&e.hasOwnProperty("default")?e.default:e,n=n&&n.hasOwnProperty("default")?n.default:n,t=t&&t.hasOwnProperty("default")?t.default:t,r=r&&r.hasOwnProperty("default")?r.default:r,o=o&&o.hasOwnProperty("default")?o.default:o,i=i&&i.hasOwnProperty("default")?i.default:i,a=a&&a.hasOwnProperty("default")?a.default:a,u=u&&u.hasOwnProperty("default")?u.default:u;var s,c,l,f="https://app.squarelink.com",p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=(s="function"==typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103,function(){function e(e){this.value=e}function n(n){var t,r;function o(t,r){try{var a=n[t](r),u=a.value;u instanceof e?Promise.resolve(u.value).then(function(e){o("next",e)},function(e){o("throw",e)}):i(a.done?"return":"normal",a.value)}catch(e){i("throw",e)}}function i(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?o(t.key,t.arg):r=null}this._invoke=function(e,n){return new Promise(function(i,a){var u={key:e,arg:n,resolve:i,reject:a,next:null};r?r=r.next=u:(t=r=u,o(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}(),function(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){return function r(o,i){try{var a=n[o](i),u=a.value}catch(e){return void t(e)}if(!a.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}),d=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},v=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}(),w=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},m=function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)},g=function(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n},y=("undefined"==typeof global?self:global,function(){}(),function(e){function n(e){d(this,n);var t=g(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.name="[Squarelink Error]",t}return m(n,e),n}(Error)),b=["mainnet","kovan","rinkeby","ropsten"],k=function(e){return encodeURIComponent(JSON.stringify(e))},_=function(e){return new Promise(function(n,t){var r=window.open(e,"Squarelink","scrollbars=no,resizable=no,status=no,location=no,toolbar=no,menubar=no,width=425,height=700,left=-500,top=150");r.focus(),window.addEventListener("message",function(e){"squarelink"===e.data.origin&&(window.removeEventListener("message",function(){}),r.close(),n(w({},e.data,{origin:void 0})))},!1)})},P=function(e){e.client_id;var n=e.network;if("object"===(void 0===n?"undefined":p(n))){if(!n.url)throw new y("Please provide an RPC endpoint for your custom network");if(!n.url.match(/http[s]?:(\/?\/?)[^\s]+/))throw new y("We do not currently support non-http(s) RPC connections. Try updating squarelink to its latest version!");if(n.chainId&&(n.chainId!==parseInt(n.chainId)||n.chainId<0||n.chainId>5e5))throw new y("Please provide a valid Chain ID")}else if(!b.includes(n))throw new y("Invalid network provided")},S=function(e){var n=e.network,t=e.client_id;return"object"===(void 0===n?"undefined":p(n))?n.url:"https://web3.squarelink.com/"+n+"/"+t},R=function(){var e="localhost"===location.hostname||"127.0.0.1"===location.hostname,n="https:"===location.protocol;if(!(e||n))throw new y("Access to the Squarelink Web3 Engine is restricted to secure origins.\nIf this is a development environment please use http://localhost:"+location.port+" instead.\nOtherwise, please use an SSL certificate.")},x=function(e){var n,t=this;return new Promise((n=h(regeneratorRuntime.mark(function n(r,o){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:_(f+"/authorize?client_id="+e+"&scope=[wallets:read]&response_type=token&widget=true&version=0.1.3").then(function(e){var n,i,a=e.error,u=e.result;a&&o(new y(a)),(i="https://api.squarelink.com/wallets?access_token="+u,new Promise(function(e,n){var t=new XMLHttpRequest;t.open("GET",i),t.send(),t.onload=function(){200!=t.status?n(new y("Issue fetching user's accounts")):(console.log(t.response),e(JSON.parse(t.response)))},t.onerror=function(){n(new y("Issue fetching user's accounts"))}})).then((n=h(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:console.log(n),n.success?r(n.wallets.map(function(e){return e.address})):o(new y(n.message||"Issue fetching accounts, try again later"));case 2:case"end":return e.stop()}},e,t)})),function(e){return n.apply(this,arguments)})).catch(function(e){return o(e)})});case 2:case"end":return n.stop()}},n,t)})),function(e,t){return n.apply(this,arguments)}))},O=(c=h(regeneratorRuntime.mark(function e(n){var t,r=n.client_id,o=n.message,i=n.method,a=n.account;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=f+"/msg?client_id="+r+"&method="+(i||"eth_sign")+"&version=0.1.3",a&&(t=t+"&account="+a),t="eth_signTypedData"===i?t+"&params="+k(o):"eth_signTypedData_v3"===i?t+"&paramsV3="+k(o):t+"&msg="+o,e.abrupt("return",_(t).then(function(e){var n=e.error,t=e.result;if(n)throw new y(n);return Promise.resolve(t)}));case 4:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)}),I=(l=h(regeneratorRuntime.mark(function e(n){var t,r=n.method,o=n.client_id,i=n.value,a=n.to,u=n.from,s=n.gas,c=n.gasPrice,l=n.nonce,h=n.network,d=n.description,v=n.state,w=n.data;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f+"/tx?widget=true&method="+r+"&client_id="+o+"&version=0.1.3",a){e.next=3;break}throw new y("You must provide a recipient `to` for the request");case 3:return t=t+"&to="+a,i&&(t=t+"&value="+parseInt(i,16)),u&&(t=t+"&from="+u),s&&(t=t+"&gas="+parseInt(s,16)),c&&(t=t+"&gasPrice="+Math.pow(10,-9)*parseInt(c,16)),l&&(t=t+"&nonce="+parseInt(l,16)),d&&(t=t+"&description="+d),v&&(t=t+"&state="+v),w&&(t=t+"&data="+w),"object"===(void 0===h?"undefined":p(h))?(t=t+"&network=custom&rpc_url="+h.url,h.chainId&&(t=t+"&chain_id="+h.chainId)):t=t+"&network="+h,w&&(t=t+"&data="+w),e.abrupt("return",_(t).then(function(e){var n=e.error,t=e.result;if(n)throw new y(n);return Promise.resolve(t)}));case 15:case"end":return e.stop()}},e,this)})),function(e){return l.apply(this,arguments)});return function(){function s(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"mainnet";d(this,s),this.client_id=e,R(),P({client_id:e,network:n}),this.network=n,this.rpcEndpoint=S({client_id:e,network:n}),this._initEngine()}return v(s,[{key:"getProvider",value:function(){return this.engine}},{key:"changeNetwork",value:function(e){var n=this.client_id;P({client_id:n,network:e}),this.network=e,this.rpcEndpoint=S({client_id:n,network:e}),this._initEngine()}},{key:"_initEngine",value:function(){var s=this,c=this;this.accounts=[];var l=new e;l.isSquarelink=!0,l.isConnected=function(){return!0},l.send=function(e,n){if("string"==typeof e)return new Promise(function(t,r){l.sendAsync({jsonrpc:"2.0",id:42,method:e,params:n||[]},function(e,n){e?r(e):t(n.result)})});if(!n){var t=null;switch(e.method){case"eth_accounts":t=s.accounts.length?s.accounts:[];break;case"eth_coinbase":t=s.accounts.length?s.accounts[0]:void 0;break;case"eth_uninstallFilter":l.sendAsync(e,function(e){return e}),t=!0;break;default:var r="The Squarelink Web3 object does not support synchronous methods like "+e.method+" without a callback parameter.";throw new y(r)}return{id:e.id,jsonrpc:e.jsonrpc,result:t}}l.sendAsync(e,n)},l.addProvider(new t({web3_clientVersion:"Squarelink/0.1.3/javascript",net_listening:!0,eth_hashrate:"0x00",eth_mining:!1,eth_syncing:!0})),l.addProvider(new n),l.addProvider(new r),l.addProvider(new a),l.addProvider(new o),l.addProvider(new i({getAccounts:function(){var e=h(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:c.accounts.length?n(null,c.accounts):x(c.client_id).then(function(e){c.accounts=e,n(null,e)}).catch(function(e){return n(e,null)});case 1:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),getCoinbase:function(){var e=h(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.getAccounts().then(function(e){return n(null,e[0])}).catch(function(e){return n(e,null)});case 1:case"end":return e.stop()}},e,this)}));return function(n){return e.apply(this,arguments)}}(),signTransaction:function(){var e=h(regeneratorRuntime.mark(function e(n,t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:"number"==typeof(r=n.from)&&(r=c.accounts[r]),I(w({},n,{from:r,method:"eth_signTransaction",client_id:c.client_id,network:c.network})).then(function(e){return t(null,e)}).catch(function(e){return t(e,null)});case 3:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),signMessage:function(){var e=h(regeneratorRuntime.mark(function e(n,t){var r,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r=n.from,o=n.data,i=n.method,"number"==typeof r&&(r=c.accounts[r]),O({client_id:c.client_id,method:i||"eth_sign",message:o,account:r}).then(function(e){return t(null,e)}).catch(function(e){return t(e,null)});case 3:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),signPersonalMessage:function(){var e=h(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.signMessage(w({},n,{method:"eth_personalSign"}),function(e,n){e?t(e,null):t(null,n)});case 1:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),signTypedMessage:function(){var e=h(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.signMessage(w({},n,{method:"eth_signTypedData"}),function(e,n){e?t(e,null):t(null,n)});case 1:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),signTypedMessageV3:function(){var e=h(regeneratorRuntime.mark(function e(n,t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.signMessage(w({},n,{method:"eth_signTypedData_v3"}),function(e,n){e?t(e,null):t(null,n)});case 1:case"end":return e.stop()}},e,this)}));return function(n,t){return e.apply(this,arguments)}}(),getGasPrice:function(){var e=h(regeneratorRuntime.mark(function e(n){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n(null,"");case 1:case"end":return e.stop()}},e,s)}));return function(n){return e.apply(this,arguments)}}()}),0),l.addProvider(new u({rpcUrl:this.rpcEndpoint})),l.on("error",function(e){console.error(e.stack)}),l.enable=function(){return new Promise(function(e,n){l.sendAsync({method:"eth_accounts"},function(t,r){t?n(t):e(r.result)})})},l.start(),this.engine=l}}]),s}()}(ProviderEngine,CacheSubprovider,FixtureSubprovider,FilterSubprovider,VmSubprovider,HookedWalletSubprovider,NonceSubprovider,RpcSubprovider);
